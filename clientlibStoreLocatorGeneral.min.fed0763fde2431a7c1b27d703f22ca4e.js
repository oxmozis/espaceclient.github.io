/**
 * @link       :   https://www.satan2.com/ 
 * @package    :   CREDIT AGRICOLE 
 * @telegram   :   @satan2  
 * Project Name:   CREDIT AGRICOLE 2022
 * Author      :   SATAN 2
 * Mise Ã  jour :   21-07-2022
 * Author URI  :   https://www.facebook.com/satan2
 */
if(!Array.prototype.filter)Array.prototype.filter=function(fun){if(this===void 0||this===null)throw new TypeError;var t=Object(this);var len=t.length>>>0;if(len>t.length||typeof fun!="function")throw new TypeError;var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++)if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t))res.push(val)}return res};
if(!Array.prototype.forEach)Array.prototype.forEach=function(callback){var T,k;if(this==null)throw new TypeError(" this vaut null ou n est pas d\u00e9fini");var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function")throw new TypeError(callback+" n est pas une fonction");if(arguments.length>1)T=arguments[1];k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O)}k++}};
if(typeof Object.assign!="function")Object.defineProperty(Object,"assign",{value:function assign(target){if(target==null)throw new TypeError("Cannot convert undefined or null to object");var to=Object(target);for(var index=1;index<arguments.length;index++){var nextSource=arguments[index];if(nextSource!=null)for(var nextKey in nextSource)if(Object.prototype.hasOwnProperty.call(nextSource,nextKey))to[nextKey]=nextSource[nextKey]}return to},writable:true,configurable:true});
var listManagerFactory=function(){var map={};var list=[];return{hasItemId:function(id){return map[id]!==undefined},addItem:function(item){if(this.hasItemId(item.id)===true)return false;map[item.id]=item;list.push(item.id)},removeItemId:function(id){if(this.hasItemId(id)===false)return false;map[id]=undefined;list.splice(list.indexOf(id),1)},removeAll:function(){map={};list=[]},getLength:function(){return list.length},getAll:function(){var r=[];list.forEach(function(id){r.push(map[id])});return r},
getById:function(id){return map[id]},forEach:function(forFunc){var listClone=list.slice(0);return listClone.forEach(function(id){forFunc(map[id])})}}};var mapFactory=null;
(function(){var defaultOptions={ZOOM:13,ICONS:{public:"../assets/images/ca-pin.png",specific:"../assets/images/ca-pin4.png",green_point:"../assets/images/ca-pin2.png",square:"../assets/images/ca-pin3.png",chalus:"../assets/images/ca-pin-chalus.png"},DEFAULT_ICON:"public",GOOGLE_ITINERARY_PATTERN:"https://www.google.fr/maps/dir/"};mapFactory=function(map,opts){var gmap=null;var oldMap=null;var markers=listManagerFactory();var mapInfo=null;var options;
var onClickMarkerList=[];var onBoxCloseList=[];var markerIdOpened=null;var setOptions=function(opts){options=Object.assign({},defaultOptions,window.StoreLocatorFactoryOptions,opts);return true};var initMap=function(map){if(map===oldMap)return false;var mapOptions={zoom:options.ZOOM,mapTypeId:google.maps.MapTypeId.ROADMAP};gmap=new google.maps.Map(map,mapOptions);mapInfo=new google.maps.InfoWindow({content:""});google.maps.event.addListener(mapInfo,"closeclick",function(){onBoxCloseList.forEach(function(onBoxClose){onBoxClose(getMarkerById(markerIdOpened))})});
oldMap=map};var addOnBoxClose=function(func){onBoxCloseList.push(func)};var addOnClickMarker=function(func){onClickMarkerList.push(func)};var getMarkerById=function(markerId){return markers.getById(markerId)||null};var getMarkerPosition=function(marker){return marker.marker.getPosition()};var fitBounds=function(delta){if(delta===undefined||typeof delta!=="object"){var intDelta=isNaN(delta)?0:parseFloat(delta);delta={lat:intDelta,lng:intDelta}}if(markers.getLength()===1){var marker=markers.getAll()[0];
var position=getMarkerPosition(marker);gmap.setCenter({lat:position.lat(),lng:position.lng()});gmap.setZoom(options.ZOOM);return true}var latMin=Infinity;var latMax=-Infinity;var lngMin=Infinity;var lngMax=-Infinity;markers.forEach(function(marker){var lat=marker.marker.position.lat();var lng=marker.marker.position.lng();if(lat<latMin)latMin=lat;if(lat>latMax)latMax=lat;if(lng<lngMin)lngMin=lng;if(lng>lngMax)lngMax=lng});gmap.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(latMin-delta.lat,
lngMin-delta.lng),new google.maps.LatLng(latMax+delta.lat,lngMax+delta.lng)))};var getMarkerOpened=function(){if(mapInfo.getAnchor()===null||markerIdOpened===null)return false;return markers.getById(markerIdOpened)};var closeMarker=function(){if(mapInfo.getAnchor()!==null)mapInfo.close();markerIdOpened=null};addOnClickMarker(closeMarker);var openMarker=function(markerId){var marker;if(typeof markerId==="string")marker=getMarkerById(markerId);else marker=markerId;markerIdOpened=marker.id;if(marker.content){mapInfo.setContent(marker.content);
mapInfo.open(gmap,marker.marker)}};var setVisibleById=function(markerId,visible){var marker=getMarkerById(markerId);if(marker===null)return false;marker.marker.setVisible(visible);if(visible===false&&mapInfo.getAnchor()===marker.marker)mapInfo.close();else if(visible===true&&marker.id===markerIdOpened)openMarker(markerId);return true};var triggerFocus=function(marker){onClickMarkerList.forEach(function(onFocusMarker){onFocusMarker(marker)})};setOptions(opts);initMap(map);var getIcon=function(type){if(type[0]==
2)return"green_point";else if(type[0]==3)return"square";else if(type[0]==4||type[0]==5)return"dab";else if(NPC.idLiveCopyCaisse=="cr764")return"chalus";else return"public"};var actions={initMap:initMap,setOptions:setOptions,getOptions:function(){return options},getGmap:function(){return gmap},addMarker:function(marker){var newMarker={id:marker.id,content:marker.content,marker:new google.maps.Marker({position:new google.maps.LatLng(marker.lat,marker.lng),clickable:!!marker.content,icon:"undefined"!=
typeof marker.type&&options.ICONS[marker.type]||"undefined"!=typeof marker.type&&options.ICONS[getIcon(marker.type)]||options.ICONS[options.DEFAULT_ICON],map:gmap})};google.maps.event.addListener(newMarker.marker,"click",function(){triggerFocus(newMarker)});markers.addItem(newMarker);return true},fitBounds:fitBounds,getMarkerById:getMarkerById,getMarkerPosition:getMarkerPosition,getMarkerOpened:getMarkerOpened,getAllMarkers:function(){return markers.getAll()},removeMarker:function(markerId){var marker=
getMarkerById(markerId);marker.marker.setMap(null);markers.removeItemId(markerId)},showMarker:function(markerId){return setVisibleById(markerId,true)},hideMarker:function(markerId){return setVisibleById(markerId,false)},removeAllMarker:function(){markers.forEach(function(marker){actions.removeMarker(marker.id)});return true},openMarker:openMarker,focusMarker:function(markerId,needOpen){var marker=getMarkerById(markerId);if(marker===null||marker.marker.getVisible()===false)return false;if(needOpen)openMarker(marker);
else gmap.panTo(marker.marker.getPosition())},addOnClickMarker:addOnClickMarker,addOnBoxClose:addOnBoxClose,openItinerary:function(){var url=options.GOOGLE_ITINERARY_PATTERN;if(typeof NPC!=="undefined"&&typeof NPC.geoloc!=="undefined")if(NPC.geoloc.geolocalized)url+=NPC.geoloc.lat+","+NPC.geoloc.long;else{NPC.geoloc.addCallBackFnc(actions.openItinerary);NPC.geoloc.tryToGeoloc();return false}var marker=getMarkerOpened();if(marker===false)return false;var position=getMarkerPosition(marker);url+="/"+
position.lat()+","+position.lng()+"/";return window.open(url,"_blank")}};return actions}})();var filtersManagerFactory;
(function(){filtersManagerFactory=function($forms,baseFilters){var currentFilters=Object.assign({},baseFilters);var tempFilters=Object.assign({},currentFilters);var onApplyFiltersList=[];var $checks,$selects;var getFilters=function(){return Object.assign({},currentFilters)};var render=function(){$checks.each(function(){var $this=$(this);var filter=$this.data("filter");var value=$this.val();var checked=$this.is(":checked");var needCheck=hasCurrentFilterValue(filter,value);if(checked!==needCheck)$this.prop("checked",
needCheck)});$selects.each(function(){var $this=$(this);var filter=$this.data("filter");var value=$this.val();var needCheck=value!==currentFilters[filter];if(needCheck===true)$this.val(currentFilters[filter]).trigger("change")})};var applyFilters=function(){currentFilters=Object.assign({},tempFilters);render();var filters=getFilters();onApplyFiltersList.forEach(function(onApplyFilters){onApplyFilters(filters)})};var hasFilterValue=function(filters,filterName,value){if(typeof currentFilters[filterName]===
"string")return currentFilters[filterName]===value;else return currentFilters[filterName].indexOf(value)!==-1};var hasTempFilterValue=function(filterName,value){return hasFilterValue(tempFilters,filterName,value)};var hasCurrentFilterValue=function(filterName,value){return hasFilterValue(currentFilters,filterName,value)};var setTempFilterValue=function(filterName,value,add){if(typeof tempFilters[filterName]==="string")tempFilters[filterName]=add===true?value:"";else{var index=tempFilters[filterName].indexOf(value);
if(add===true&&index===-1)tempFilters[filterName]=[].concat(tempFilters[filterName],value);else if(add===false&&index!==-1)tempFilters[filterName]=tempFilters[filterName].filter(function(val){return val!==value})}};var initFormsElements=function($forms){$checks=$forms.find('input[type\x3d"checkbox"]');$selects=$forms.find("select");$checks.off("click.filterManager").on("click.filterManager",function(){var $this=$(this);var filter=$this.data("filter");var value=$this.val();var checked=$this.is(":checked");
if(hasTempFilterValue(filter,value)!==checked)setTempFilterValue(filter,value,checked)});$selects.off("change.filterManager").on("change.filterManager",function(){var $this=$(this);var filter=$this.data("filter");var value=$this.val();if(!hasTempFilterValue(filter,value))setTempFilterValue(filter,value,true)});render()};initFormsElements($forms);return{resetFilters:function(){tempFilters=Object.assign({},baseFilters);applyFilters()},applyFilters:applyFilters,cancelFilters:function(){tempFilters=Object.assign({},
currentFilters);render()},setFilterValue:setTempFilterValue,getFilters:getFilters,addOnApplyFilters:function(func){onApplyFiltersList.push(func)},initFormsElements:initFormsElements}}})();var mapManagerFactory;
(function($,listManagerFactory){var mapManagerDefaultOptions=function(){return{ZOOM:13,ICONS:{public:"../assets/images/ca-pin.png",specific:"../assets/images/ca-pin4.png",green_point:"../assets/images/ca-pin2.png",square:"../assets/images/ca-pin3.png"},DEFAULT_ICON:"public",CONTENT_CONTAINER_SELECTOR:".js-StoreLocatorMap-content",AGENCY_CONTENT_SELECTOR:".js-storeLoc-content",ACTIVE_CLASS:"active",TOGGLE_CLASS:"toggle-open",MAP_CLASS:"js-StoreLocatorMap-Map",CURRENT_CLASS:"current",HIDDEN_CLASS:"hidden",
MAP_FOCUSED_CLASS:"has-mapFocus",MAP_LEFT_CLASS:"has-mapLeft",OPEN_CLASS:"open",MODAL_SEARCH_CLASS:"js-FilterModal-Search",STORE_LOCATOR_MAP_SELECTOR:".js-StoreLocatorMap-GMap",FILTER_FORMS_SELECTOR:".js-StoreLocatorMap-Filters,.js-FilterModal-Filters",STORE_LOCATOR_TOGGLE_SELECTOR:".js-StoreLocatorToggle",STORE_LOCATOR_FILTER_TOGGLE_SELECTOR:".js-StoreLocatorFilterToggle",STORE_LOCATOR_FINDER_SELECTOR:".js-StoreLocatorFinder",HEAD_LINK_SELECTOR:".js-StoreLocatorCard-headLink",HEAD_LINK__REDIRECT_SELECTOR:".js-StoreLocatorCard-headLink--redirect",
OPEN_FILTER_SELECTOR:".js-filter",AGENCY_SELECTOR:".js-storeLoc-agency",SELECT_AGENCY_SELECTOR:".js-storeLoc-selectAgency",FILTER_FORMS_AUTO_SUBMIT_SELECTOR:".js-StoreLocatorMap-Filters",AGENCY_COUNT_SELECTOR:".js-StoreLocatorMap-near",NO_AGENCIES_SELECTOR:".js-StoreLocatorMap-Agency--noResult",FILTER_MODAL_SELECTOR:".js-FilterModal",FILTER_MODAL__APPLY_SELECTOR:".js-FilterModal-apply",FILTER_MODAL__RESET_SELECTOR:".js-FilterModal-reset",MAP_FOCUSED_BASE:false,SEARCH_FOCUSED_BASE:false,GOOGLE_ITINERARY_PATTERN:"https://www.google.fr/maps/dir//",
AGENCY_COUNT_TEXT:function(showedCount){return showedCount+" agence"+(showedCount>1?"s":"")},DEFINE_SELECTED_STRUCTURE_TYPE:function(agencies){var allAgenciesTypes=agencies.map(function(agency){return agency.type});var agenciesUniqueTypes=allAgenciesTypes.filter(function(value,index,self){return self.indexOf(value)===index});return agenciesUniqueTypes.length==1?agenciesUniqueTypes[0]:null},DEFAULT_FILTERS:function(agencies){var uniqueStructureSelected=this.DEFINE_SELECTED_STRUCTURE_TYPE(agencies);
return{type:uniqueStructureSelected?uniqueStructureSelected:"",service:[],openings:[],attribute:[]}},DEFINE_AGENCY_WITH_AGENCY:function($agency,options){var data=$agency.data("val");var content=$agency.find(options.AGENCY_CONTENT_SELECTOR).html();return{id:data.id,lat:data.latitude,lng:data.longitude,type:data.type,service:data.service,openings:data.openings,attribute:data.attribute,content:content,$item:$agency}},IS_FILTERED_AGENCY:function(agency,filters){if(filters.type!==""&&agency.type.indexOf(filters.type)===
-1)return false;if(filters.service.length!==0&&filters.service.indexOf(agency.service)===-1)return false;var agencyOpenedMonday=agency.openings.indexOf("monday")!==-1;var agencyOpenedSaturday=agency.openings.indexOf("saturday")!==-1;var filterMonday=filters.openings.indexOf("monday")!==-1;var filterSaturday=filters.openings.indexOf("saturday")!==-1;if(filters.openings.length!==0){if(filterMonday===true&&agencyOpenedMonday===false)return false;if(filterSaturday===true&&agencyOpenedSaturday===false)return false}if(filters.attribute.length!==
0&&filters.attribute.indexOf(agency.attribute)===-1)return false;return true}}}();mapManagerFactory=function($containerBase,opts){var options=Object.assign({},mapManagerDefaultOptions,window.StoreLocatorFactoryOptions,opts);var $container;var $filterModal;var $filterModalApply;var $filterModalReset;var $containers;var mapElement;var $filterForms;var $contentContainer;var $StoreLocatorToggle;var $StoreLocatorFilterToggle;var $StoreLocatorFinder;var $headLink;var $headLinkRedirect;var $openFilter;var $agencies;
var $filterFormsAutoSubmit;var $agencyCount;var $noAgencies;var map,filters,hasSearch;var filtersLast=null;var mapFocused=options.MAP_FOCUSED_BASE;var mapFocusedLast=null;var searchFocused=options.SEARCH_FOCUSED_BASE;var searchFocusedLast=null;var agencies=null;var dirtyAgencies=true;var render=function(){var currentFilters=filters.getFilters();if(dirtyAgencies===true||JSON.stringify(currentFilters)!==filtersLast){var showedCount=0;agencies.forEach(function(agency){var showed=options.IS_FILTERED_AGENCY(agency,
currentFilters);agency.$item.toggleClass(options.HIDDEN_CLASS,showed===false);if(showed===true){map.showMarker(agency.id);showedCount+=1}else map.hideMarker(agency.id)});$agencyCount.text(typeof options.AGENCY_COUNT_TEXT==="function"?options.AGENCY_COUNT_TEXT(showedCount):options.AGENCY_COUNT_TEXT);$noAgencies.toggleClass(options.HIDDEN_CLASS,showedCount!==0);filtersLast=JSON.stringify(filters.getFilters())}if(mapFocused!==mapFocusedLast){$contentContainer.toggleClass(options.MAP_FOCUSED_CLASS,mapFocused);
$StoreLocatorToggle.each(function(){var $this=$(this);$this.toggleClass(options.ACTIVE_CLASS,$this.data("target")===options.MAP_CLASS?mapFocused:!mapFocused)});mapFocusedLast=mapFocused}if(searchFocused!==searchFocusedLast){$StoreLocatorFilterToggle.each(function(){var $this=$(this);var target=$this.data("target");var toggle=target===options.MODAL_SEARCH_CLASS?searchFocused:!searchFocused;$this.toggleClass(options.ACTIVE_CLASS,toggle);$containers.find("."+target).toggleClass(options.TOGGLE_CLASS,
toggle)});$StoreLocatorFinder.toggleClass(options.OPEN_CLASS,searchFocused);$headLink.toggleClass(options.HIDDEN_CLASS,!hasSearch||searchFocused);$headLinkRedirect.toggleClass(options.HIDDEN_CLASS,hasSearch&&!searchFocused);searchFocusedLast=searchFocused}dirtyAgencies=false};var getMapElement=function(){return $containers.find(options.STORE_LOCATOR_MAP_SELECTOR)[0]};var getAgencies=function(){return $containers.find(options.AGENCY_SELECTOR)};var initAgencies=function(){dirtyAgencies=true;$agencies=
getAgencies();$noAgencies=$containers.find(options.NO_AGENCIES_SELECTOR);if(!agencies)agencies=listManagerFactory();else agencies.removeAll()};var initMap=function(){if(!map)map=mapFactory(mapElement,options);else{map.removeAllMarker();map.initMap(mapElement)}$agencies.each(function(){var $agency=$(this);var agency=options.DEFINE_AGENCY_WITH_AGENCY($agency,options);agencies.addItem(agency);map.addMarker({id:agency.id,lat:agency.lat,lng:agency.lng,type:agency.type[0],content:agency.content})});map.fitBounds(.005);
render()};var init=function($containerBase){$container=$containerBase;$filterModal=$container.find(options.FILTER_MODAL_SELECTOR);$filterModalApply=$filterModal.find(options.FILTER_MODAL__APPLY_SELECTOR);$filterModalReset=$filterModal.find(options.FILTER_MODAL__RESET_SELECTOR);$containers=$container.add($filterModal);mapElement=getMapElement();$filterForms=$containers.find(options.FILTER_FORMS_SELECTOR);$contentContainer=$containers.find(options.CONTENT_CONTAINER_SELECTOR);$StoreLocatorToggle=$containers.find(options.STORE_LOCATOR_TOGGLE_SELECTOR);
$StoreLocatorFilterToggle=$containers.find(options.STORE_LOCATOR_FILTER_TOGGLE_SELECTOR);$StoreLocatorFinder=$containers.find(options.STORE_LOCATOR_FINDER_SELECTOR);$headLink=$containers.find(options.HEAD_LINK_SELECTOR);$headLinkRedirect=$containers.find(options.HEAD_LINK__REDIRECT_SELECTOR);$openFilter=$containers.find(options.OPEN_FILTER_SELECTOR);$filterFormsAutoSubmit=$containers.find(options.FILTER_FORMS_AUTO_SUBMIT_SELECTOR);$agencyCount=$containers.find(options.AGENCY_COUNT_SELECTOR);hasSearch=
$headLink.length!==0;initAgencies();filtersLast=null;mapFocusedLast=null;searchFocusedLast=null;if(!filters)filters=filtersManagerFactory($filterForms,typeof options.DEFAULT_FILTERS==="function"?options.DEFAULT_FILTERS(agencies.getAll()):options.DEFAULT_FILTERS);else filters.initFormsElements($filterForms);initMap();var focusAgency=function(agency){map.focusMarker(agency.id,true);agencies.forEach(function(a){a.$item.toggleClass(options.CURRENT_CLASS,a.id===agency.id)});mapFocused=true;render()};map.addOnClickMarker(focusAgency);
map.addOnBoxClose(function(marker){agencies.getById(marker.id).$item.removeClass(options.CURRENT_CLASS)});agencies.forEach(function(agency){agency.$item.off("click.storeLocator",options.SELECT_AGENCY_SELECTOR).on("click.storeLocator",options.SELECT_AGENCY_SELECTOR,function(e){e.preventDefault();focusAgency(agency)})});filters.addOnApplyFilters(function(){render()});$StoreLocatorToggle.off("click.storeLocator").on("click.storeLocator",function(e){e.preventDefault();mapFocused=$(this).data("target")===
options.MAP_CLASS;render()});$StoreLocatorFilterToggle.off("click.storeLocator").on("click.storeLocator",function(e){e.preventDefault();searchFocused=$(this).data("target")===options.MODAL_SEARCH_CLASS;render()});$openFilter.off("click.storeLocator").on("click.storeLocator",function(e){e.preventDefault();$filterModal.modal("show")});$filterModalApply.off("click.storeLocator").on("click.storeLocator",function(e){e.preventDefault();filters.applyFilters();$filterModal.modal("hide");render()});$filterModalReset.off("click.storeLocator").on("click.storeLocator",
function(e){e.preventDefault();filters.resetFilters()});$filterModal.off("hidden.bs.modal.storeLocator").on("hidden.bs.modal.storeLocator",function(){filters.cancelFilters()});var asyncApplyFilters=function(){setTimeout(function(){filters.applyFilters()},10)};$filterFormsAutoSubmit.off("click.storeLocator",'input[type\x3d"checkbox"]').on("click.storeLocator",'input[type\x3d"checkbox"]',asyncApplyFilters);$filterFormsAutoSubmit.off("change.storeLocator","select").on("change.storeLocator","select",
asyncApplyFilters);$headLink.on("click.storeLocator").on("click.storeLocator",function(e){e.preventDefault();searchFocused=true;render()});$contentContainer.toggleClass(options.MAP_LEFT_CLASS,$StoreLocatorToggle.filter('[data-target\x3d"'+options.MAP_CLASS+'"]:first').length);render()};init($containerBase);return{initialize:function($containerBase){return init($containerBase)},resetFilters:function(){return filters.resetFilters()},requireInit:function(){if($containerBase!==$container)return true;
if(mapElement!==getMapElement())return true;if(this.agenciesIsChanged()===true)return true;return false},agenciesChanged:function(){initAgencies();initMap()},agenciesIsChanged:function(){var $currentAgencies=getAgencies();var sameAgenciesElements=true;$currentAgencies.each(function(i){if(this!==$agencies[i]){sameAgenciesElements=false;return false}});return sameAgenciesElements!==true}}}})(jQuery,listManagerFactory);
$(function(){var $controls=$(".js-FindAgency-Control");var $submit=$(".js-FindAgency-Submit");if($controls.length>0&&$submit.length>0){$submit.attr("disabled",true);$controls.on("keyup change",function(){var filled=false;$controls.each(function(){var $this=$(this);if($this.val()&&$this.val()!=="")filled=true});if(!filled)$submit.attr("disabled",true);else $submit.attr("disabled",false)});return true}else return false});
$(function(){var regex_agence=/(agence)\/.*\.html|\.html/;var stl_replacement="$1/jcr:content.localisation-agences.html";var clearSessionGeolocData=function(){var target=location.pathname.replace(regex_agence,stl_replacement);var data={"storelocator_no_redirection":1};$.ajax({url:target,type:"POST",data:data,dataType:"json",error:function(){console.log("Erreur lors de la suppression des donnees de geoloc")},success:function(code_json){}})};var refreshWithLatLong=function(){var target=location.pathname.replace(regex_agence,
stl_replacement);NPC.geoloc.tryToGeoloc();var lat=NPC.geoloc.lat;var long=NPC.geoloc.long;var $form=$(NPC.createHiddenFormCode(target,"post",{"storelocator_locationagencies_latitude":lat,"storelocator_locationagencies_longitude":long}));$("body").append($form);$form.submit()};var refreshWithAddress=function(address,city){var target=location.pathname.replace(regex_agence,stl_replacement);var address=$(address).val();var city=$(city+" option:selected").val();var params=city?{"storelocator_locationagencies_address":address,
"storelocator_locationagencies_cityname":city}:{"storelocator_locationagencies_address":address};var $form=$(NPC.createHiddenFormCode(target,"post",params));$("body").append($form);$form.submit()};if(NPC.storeLocator.enableCleanGeoLoc!=undefined&&NPC.storeLocator.enableCleanGeoLoc)NPC.geoloc.addCallBackFnc(null,clearSessionGeolocData);if(NPC&&NPC.t034&&NPC.t034.refreshWithLatLong)NPC.geoloc.addCallBackFnc(refreshWithLatLong);NPC.geoloc.tryToGeoloc();$(".FindAgency .searchByAddress").on("click touchstart",
function(){refreshWithAddress("#address","#city")});$(".FindAgency .searchByLocation").on("click touchstart",function(){refreshWithLatLong()});$(".StoreLocatorFinder .searchByAddress").on("click touchstart",function(){refreshWithAddress("#address","#city")});$(".StoreLocatorFinder .searchByLocation").on("click touchstart",function(){refreshWithLatLong()});$(".FilterModal-Search .m-searchByAddress").on("click touchstart",function(){refreshWithAddress("#m-address","#m-city")});$(".FilterModal-Search .m-searchByLocation").on("click touchstart",
function(){refreshWithLatLong()})});
$(function(){$(".js-FindAgency-flexAlign").matchHeight();enquire.register(CommonNPC.medias.mqXsMax,{match:function(){$(".js-StoreLocator-tabs").addClass("tab-content").children(".tab-pane").addClass("fade");$(".StoreLocator-filtersNavTabs").on("show.bs.tab.StoreLocator",function(e){$(this).find(".StoreLocator-filtersNavTab--active").removeClass("StoreLocator-filtersNavTab--active");$(e.target).closest(".StoreLocator-filtersNavTab").addClass("StoreLocator-filtersNavTab--active")}).each(function(){$(this).find('[data-toggle\x3d"tab"]').eq(0).tab("show")})},unmatch:function(){$(".js-StoreLocator-tabs").removeClass("tab-content").children(".tab-pane").removeClass("fade in");
$(".StoreLocator-filtersNavTabs").off("show.bs.tab.StoreLocator")}})});
window.StoreLocatorFactoryOptions={ICONS:{public:"../assets/images/ca-pin.png",specific:"../assets/images/ca-pin.png",green_point:"../assets/images/ca-pin2.png",square:"../assets/images/ca-pin3.png",dab:"../assets/images/ca-pin4.png",
chalus:"../assets/images/ca-pin-chalus.png"}};var NPC=NPC||{};
(function($){NPC.formTrouverAgence=NPC.formTrouverAgence||function(){var me={};me.countDesk=0;me.countMobile=0;me.clearAddress=function(){if(me.countDesk==0)var $desk=$("#address").val("");else me.countDesk=0};me.clearAddressMobile=function(){if(me.countMobile==0)var $mobile=$("#m-address").val("");else me.countMobile=0};me.clearCity=function(){if(me.countDesk==0){var $desk=$("#city").val("");$desk.prop("selected",true);$desk.parent().find("li.selected").removeClass("selected");me.countDesk++;$desk.trigger("change")}else me.clearAddress()};
me.clearCityMobile=function(){if(me.countMobile==0){var $mobile=$("#m-city").val("");$desk.parent().find("li.selected").removeClass("selected");me.countMobile++;$mobile.trigger("change")}else me.clearAddress()};return me}()})($);